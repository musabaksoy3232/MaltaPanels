<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Malta Sorgu Paneli</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg-login: url('https://tor-lodz.pl/supercars/porsche-911-turbo-s?srsltid=AfmBOoo6q-63UfNTBJ2C-ksH8wOb5M2Q4KGCI1RDHe-FS6gOJR5z0epL');
  --dark-900:#041020;
  --card: rgba(10,14,20,0.86);
  --muted:#9fb0c2;
  --accent:#06b6d4;
  --accent2:#6ee7b7;
  --glass: rgba(255,255,255,0.03);
  --success:#2dd4bf;
  --danger:#ff6b6b;
}
*{box-sizing:border-box;font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Arial;}
html,body{height:100%;margin:0;background:var(--dark-900);color:#e6f7fb;overflow:hidden}

/* modes */
body.login-mode{ background-image: linear-gradient(rgba(0,0,0,0.44), rgba(0,0,0,0.44)), var(--bg-login); background-size:cover; background-position:center; }
body.app-mode{ background: linear-gradient(180deg,#071226,#001018); }

/* app wrapper */
.app{position:relative;z-index:2;max-width:1200px;margin:28px auto;padding:16px;height:calc(100vh - 56px);display:flex;flex-direction:column;gap:12px}

/* topbar */
.topbar{display:flex;align-items:center;gap:14px;background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:12px;border-radius:12px;backdrop-filter: blur(6px)}
.hamb{width:56px;height:56px;border-radius:12px;background:var(--card);display:flex;align-items:center;justify-content:center;cursor:pointer;border:1px solid var(--glass);box-shadow:0 8px 24px rgba(0,0,0,0.5);user-select:none}
.brand{display:flex;flex-direction:column}
.brand h1{margin:0;font-size:18px}
.brand p{margin:0;color:var(--muted);font-size:12px}
.flex-spacer{flex:1}

/* layout */
.layout{display:flex;gap:16px;height:100%}
main.panel{flex:1;display:flex;flex-direction:column;gap:12px;min-height:0}

/* side nav (off-canvas) */
.side-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.45);z-index:40;display:none}
.side-nav{
  position:fixed;left:0;top:0;bottom:0;width:340px;transform:translateX(-100%);
  background:linear-gradient(180deg, rgba(3,6,10,0.98), rgba(6,10,14,0.98));
  box-shadow:0 18px 80px rgba(0,0,0,0.6);padding:18px;z-index:50;transition: transform .26s ease;display:flex;flex-direction:column;
}
.side-nav.open{ transform: translateX(0) }
.side-nav .handle{height:6px;width:48px;background:rgba(255,255,255,0.03);border-radius:6px;margin:6px auto}
.side-nav .user{padding:8px;background:rgba(255,255,255,0.02);border-radius:8px;margin-bottom:8px}
.menu-scroll{overflow-y:auto;padding-right:6px;height:calc(100vh - 220px)}
.cat{margin-top:12px;margin-bottom:8px;color:var(--muted);font-size:13px}
.api-item{display:flex;justify-content:space-between;align-items:center;padding:8px;border-radius:8px;cursor:pointer}
.api-item:hover{background:rgba(255,255,255,0.02)}
.api-item.locked{opacity:.55}
.lock-pill{font-size:12px;color:var(--muted)}

/* main UI */
.card{background:var(--card);border-radius:12px;padding:16px;border:1px solid rgba(255,255,255,0.02);box-shadow:0 14px 40px rgba(0,0,0,0.6);min-height:0}
.panel-head{display:flex;justify-content:space-between;align-items:center}
.params{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:10px;margin-top:12px}
input,select,textarea{background:transparent;border:1px solid rgba(255,255,255,0.04);color:inherit;padding:10px;border-radius:8px;width:100%}
.btn-primary{background:linear-gradient(90deg,var(--accent2),var(--accent));border:none;color:#012;padding:10px 14px;border-radius:10px;cursor:pointer}
.btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px;border-radius:8px;color:var(--muted);cursor:pointer}

/* right column results */
.right-col{width:420px;min-height:100%;display:flex;flex-direction:column;gap:12px}
.result-box{background:rgba(2,6,12,0.7);padding:12px;border-radius:10px;min-height:320px;white-space:pre-wrap;overflow:auto;border:1px solid rgba(255,255,255,0.02);color:#dffcf3}

/* admin area */
.admin-area{margin-top:12px;background:rgba(255,255,255,0.02);padding:12px;border-radius:10px}
.muted{color:var(--muted);font-size:13px}

/* login modal */
.login-modal{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;z-index:60}
.login-card{width:920px;max-width:96%;display:grid;grid-template-columns:1fr 420px;border-radius:14px;overflow:hidden;box-shadow:0 30px 80px rgba(0,0,0,0.7)}
.login-left{background:linear-gradient(180deg, rgba(6,10,18,0.96), rgba(4,8,14,0.92));padding:30px;display:flex;flex-direction:column;gap:14px}
.login-right{background:center/cover;padding:30px;display:flex;align-items:center;justify-content:center}
.glass{background:rgba(255,255,255,0.02);padding:12px;border-radius:10px;width:100%}
.login-actions{display:flex;gap:10px}

/* responsive */
@media(max-width:980px){ .right-col{display:none} .side-nav{width:300px} .login-card{grid-template-columns:1fr} }
@media(max-width:640px){ .hamb{width:48px;height:48px} .side-nav{width:260px} }
</style>
</head>
<body class="login-mode">

<!-- overlay for side nav -->
<div class="side-overlay" id="sideOverlay" style="display:none"></div>

<!-- side nav -->
<aside class="side-nav" id="sideNav" aria-hidden="true">
  <div class="handle"></div>
  <div class="user" id="sideUser">HenÃ¼z giriÅŸ yok</div>

  <div class="menu-scroll" id="menuContainer">
    <!-- injected -->
  </div>

  <div style="margin-top:12px;display:flex;gap:8px">
    <button class="btn-ghost" id="openMarketBtn">Market</button>
    <button class="btn-ghost" id="logoutBtn">Ã‡Ä±kÄ±ÅŸ</button>
  </div>
</aside>

<!-- main app container -->
<div class="app" id="app">
  <header class="topbar">
    <div class="hamb" id="hambBtn" title="MenÃ¼yÃ¼ aÃ§/kapat">â˜°</div>
    <div class="brand">
      <h1>Malta Sorgu Paneli</h1>
      <p class="muted">Profesyonel â€” Premium yÃ¶netimi</p>
    </div>
    <div class="flex-spacer"></div>
    <div class="muted" id="topStatus">Durum: GiriÅŸ yapÄ±lmadÄ±</div>
  </header>

  <div class="layout">
    <main class="panel card" id="mainPanel">
      <div class="panel-head">
        <h2 id="panelTitle">Sorgu Paneli</h2>
        <div class="muted" id="welcomeText">LÃ¼tfen giriÅŸ yapÄ±n</div>
      </div>

      <div style="display:flex;gap:18px;align-items:flex-start;min-height:0">
        <div style="flex:1;min-height:0">
          <div class="card">
            <div class="muted">SeÃ§ili API</div>
            <div style="font-weight:700;margin-top:6px" id="apiTitle">HenÃ¼z seÃ§ilmedi</div>
            <div class="muted" style="margin-top:6px">EriÅŸim: <span id="apiFlag">â€”</span></div>

            <div style="margin-top:12px" class="muted">Parametreler</div>
            <div class="params" id="paramsArea"></div>

            <div style="margin-top:12px;display:flex;gap:8px">
              <button class="btn-primary" id="runQueryBtn">Sorgula</button>
              <button class="btn-ghost" id="clearBtn">Temizle</button>
            </div>
          </div>

          <div class="card" style="margin-top:12px">
            <div class="muted">GeÃ§miÅŸ (Bu oturum)</div>
            <pre id="historyArea" class="muted" style="white-space:pre-wrap;min-height:120px">HenÃ¼z sorgu yok.</pre>
          </div>

          <div id="adminArea" class="admin-area" style="display:none">
            <h4>Admin - Premium Ver</h4>
            <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:8px">
              <input id="newUserEmail" placeholder="KullanÄ±cÄ± e-posta (Ã¶rnek: user@gmail.com)" style="min-width:220px">
              <input id="newUserPass" placeholder="Åžifre">
              <select id="newUserDuration">
                <option value="1">1 GÃ¼n</option>
                <option value="7">7 GÃ¼n</option>
                <option value="30">30 GÃ¼n</option>
                <option value="365">365 GÃ¼n</option>
              </select>
              <button class="btn-primary" id="createPremiumBtn">Premium Ver / KullanÄ±cÄ± OluÅŸtur</button>
            </div>
            <div class="muted">Form: e-posta + ÅŸifre + sÃ¼re. SÃ¼re dolunca o kullanÄ±cÄ± giriÅŸ yapamayacak.</div>
            <div id="adminMsg" class="muted" style="margin-top:8px"></div>
          </div>

        </div>

        <aside class="right-col">
          <div class="card">
            <div class="muted">SonuÃ§</div>
            <div class="result-box" id="resultBox">Sorgu sonuÃ§larÄ± burada gÃ¶rÃ¼necek.</div>
            <div style="margin-top:12px" class="muted">Not: TarayÄ±cÄ± CORS kÄ±sÄ±tlarÄ± olabilir; Ã¼retimde server-side proxy Ã¶nerilir.</div>
          </div>
        </aside>
      </div>
    </main>
  </div>
</div>

<!-- market modal -->
<div id="marketModal" style="position:fixed;inset:0;display:none;align-items:center;justify-content:center;z-index:60">
  <div style="width:720px;max-width:96%;background:linear-gradient(180deg,rgba(6,10,18,0.96),rgba(3,6,10,0.96));padding:22px;border-radius:12px;box-shadow:0 30px 80px rgba(0,0,0,0.6);">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <h3 style="margin:0;color:var(--accent2)">Market â€” Premium Paketler</h3>
      <button class="btn-ghost" id="closeMarketBtn">Kapat</button>
    </div>
    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:12px;margin-top:16px">
      <div style="background:rgba(255,255,255,0.02);padding:14px;border-radius:10px">
        <div style="font-weight:700">GÃ¼nlÃ¼k</div><div class="muted">1 GÃ¼n</div><div style="margin-top:8px;font-size:18px;font-weight:700">400â‚º</div>
        <button class="btn-primary" style="margin-top:10px" onclick="buyPlan('GÃ¼nlÃ¼k')">SatÄ±n Al</button>
      </div>
      <div style="background:rgba(255,255,255,0.02);padding:14px;border-radius:10px">
        <div style="font-weight:700">HaftalÄ±k</div><div class="muted">7 GÃ¼n</div><div style="margin-top:8px;font-size:18px;font-weight:700">800â‚º</div>
        <button class="btn-primary" style="margin-top:10px" onclick="buyPlan('HaftalÄ±k')">SatÄ±n Al</button>
      </div>
      <div style="background:rgba(255,255,255,0.02);padding:14px;border-radius:10px">
        <div style="font-weight:700">AylÄ±k</div><div class="muted">30 GÃ¼n</div><div style="margin-top:8px;font-size:18px;font-weight:700">2000â‚º</div>
        <button class="btn-primary" style="margin-top:10px" onclick="buyPlan('AylÄ±k')">SatÄ±n Al</button>
      </div>
      <div style="background:rgba(255,255,255,0.02);padding:14px;border-radius:10px">
        <div style="font-weight:700">YÄ±llÄ±k</div><div class="muted">365 GÃ¼n</div><div style="margin-top:8px;font-size:18px;font-weight:700">5000â‚º</div>
        <button class="btn-primary" style="margin-top:10px" onclick="buyPlan('YÄ±llÄ±k')">SatÄ±n Al</button>
      </div>
    </div>
    <div style="margin-top:14px" class="muted">SatÄ±n alma demo: Discord: <strong>SrapionV4</strong></div>
  </div>
</div>

<!-- login modal -->
<div id="loginModal" class="login-modal" style="display:flex">
  <div class="login-card">
    <div class="login-left">
      <h1 style="color:var(--accent2);margin:0">Malta Sorgu Paneli</h1>
      <p class="muted">Ãœcretsiz giriÅŸ ile sÄ±nÄ±rlÄ± sorgular â€” ÃœNÄ° dahil. Premium hesaplarla tÃ¼m sorgulara eriÅŸilir.</p>

      <div class="login-actions">
        <button class="btn-primary" id="showAdminBtn">Admin GiriÅŸ</button>
        <button class="btn-primary" id="showPremiumBtn">Premium GiriÅŸ</button>
        <button class="btn-ghost" id="doFreeLoginBtn">Ãœcretsiz GiriÅŸ</button>
      </div>

      <div class="muted">Admin yetkisi ile premium kullanÄ±cÄ± oluÅŸturabilirsiniz. (Admin: gizli)</div>
    </div>

    <div class="login-right" style="background-image: linear-gradient(rgba(0,0,0,0.28), rgba(0,0,0,0.28)), var(--bg-login); background-size:cover; background-position:center;">
      <div class="glass">
        <div id="authForms">
          <div id="adminForm" style="display:none">
            <div class="muted" style="margin-bottom:6px">Admin GiriÅŸ</div>
            <input id="adminEmail" type="email" placeholder="E-posta (admin)"/>
            <input id="adminPass" type="password" placeholder="Åžifre"/>
            <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:8px">
              <button class="btn-ghost" id="adminCancelBtn">Ä°ptal</button>
              <button class="btn-primary" id="adminSubmitBtn">GiriÅŸ</button>
            </div>
          </div>

          <div id="premiumForm" style="display:none">
            <div class="muted" style="margin-bottom:6px">Premium GiriÅŸ</div>
            <input id="premEmail" type="email" placeholder="E-posta"/>
            <input id="premPass" type="password" placeholder="Åžifre"/>
            <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:8px">
              <button class="btn-ghost" id="premCancelBtn">Ä°ptal</button>
              <button class="btn-primary" id="premSubmitBtn">GiriÅŸ</button>
            </div>
          </div>

          <div id="infoBox" style="margin-top:6px;color:var(--muted);font-size:13px">E-posta ve ÅŸifre ile giriÅŸ yapÄ±n. Ãœcretsiz giriÅŸ hesabÄ± demo amaÃ§lÄ±.</div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
/* -------------------------
   Storage & seed
--------------------------*/
const USERS_KEY = 'malta_users_v5';
function loadUsers(){ try{ return JSON.parse(localStorage.getItem(USERS_KEY)) || {}; }catch(e){ return {}; } }
function saveUsers(u){ localStorage.setItem(USERS_KEY, JSON.stringify(u)); }

/* seed admin with specified credential if not present */
(function seedAdmin(){
  const u = loadUsers();
  if(!u['admin@gmail.com']){
    u['admin@gmail.com'] = { pass: 'Malta233214', role:'admin', premium_until: null };
    saveUsers(u);
  }
})();

/* -------------------------
   API catalog (UI doesn't display provider)
   Mark: 'uni' is free, others after uni flagged premium accordingly
--------------------------*/
const CATALOG = [
  {category:'Ad & KiÅŸi', apis:[
    {id:'adsoyad', name:'Ad Soyad', endpoint:'https://hanedansystem.alwaysdata.net/hanesiz/adsoyad.php', params:['ad','soyad'], access:'free'},
    {id:'adsoyadpro', name:'Ad Soyad Pro', endpoint:'https://hanedansystem.alwaysdata.net/hanesiz/adsoyadpro.php', params:['ad','soyad','il','ilce'], access:'free'},
    {id:'adililce', name:'Ad Ä°l Ä°lÃ§e', endpoint:'https://hanedansystem.alwaysdata.net/hanesiz/adililce.php', params:['ad','il','ilce'], access:'free'},
    {id:'adil', name:'Ad Ä°l', endpoint:'https://hanedansystem.alwaysdata.net/hanesiz/adil.php', params:['ad','ilce'], access:'free'},
  ]},
  {category:'TC & GSM', apis:[
    {id:'tcpro', name:'TCPRO', endpoint:'https://hanedansystem.alwaysdata.net/hanesiz/tcpro.php', params:['tc'], access:'free'},
    {id:'tc', name:'TC Sorgu', endpoint:'https://hanedansystem.alwaysdata.net/hanesiz/tc.php', params:['tc'], access:'free'},
    {id:'serino', name:'SeriNo Sorgu', endpoint:'https://hanedansystem.alwaysdata.net/hanesiz/serino.php', params:['tc'], access:'free'},
    {id:'tcgsm', name:'TC GSM Sorgu', endpoint:'https://hanedansystem.alwaysdata.net/hanesiz/tcgsm.php', params:['tc'], access:'free'},
    {id:'gsmtc', name:'GSM TC Sorgu', endpoint:'https://hanedansystem.alwaysdata.net/hanesiz/gsmtc.php', params:['gsm'], access:'free'},
    {id:'adres', name:'Adres Sorgu', endpoint:'https://hanedansystem.alwaysdata.net/hanesiz/adres.php', params:['tc'], access:'free'},
    {id:'hane', name:'Hane Sorgu', endpoint:'https://hanedansystem.alwaysdata.net/hanesiz/hane.php', params:['tc'], access:'free'},
    {id:'aile', name:'Aile Sorgu', endpoint:'https://hanedansystem.alwaysdata.net/hanesiz/aile.php', params:['tc'], access:'free'},
    {id:'sulale', name:'SÃ¼lale Sorgu', endpoint:'https://hanedansystem.alwaysdata.net/hanesiz/sulale.php', params:['tc'], access:'free'},
    {id:'sicil', name:'Sicil', endpoint:'https://hanedansystem.alwaysdata.net/hanesiz/sicil.php', params:['eski_dosya_id'], access:'premium'},
  ]},
  {category:'EÄŸitim', apis:[
    {id:'ogretmen', name:'Ã–ÄŸretmen', endpoint:'https://hanedansystem.alwaysdata.net/hanesiz/ogretmen.php', params:['ad','soyad'], access:'free'},
    {id:'lgs', name:'LGS', endpoint:'https://hanedansystem.alwaysdata.net/hanesiz/lgs.php', params:['tc'], access:'free'},
    {id:'uni', name:'ÃœNÄ°', endpoint:'https://hanedansystem.alwaysdata.net/hanesiz/uni.php', params:['tc'], access:'free'},
    {id:'sertifika', name:'Sertifika', endpoint:'https://hanedansystem.alwaysdata.net/hanesiz/sertifika.php', params:['tc'], access:'premium'},
  ]},
  {category:'DiÄŸer & Sosyal', apis:[
    {id:'vesika', name:'Vesika', endpoint:'https://hanedansystem.alwaysdata.net/hanesiz/vesika.php', params:['tc'], access:'premium'},
    {id:'insta', name:'Instagram', endpoint:'https://hanedansystem.alwaysdata.net/hanesiz/insta.php', params:['usr'], access:'premium'},
    {id:'discord', name:'Discord', endpoint:'https://hanedansystem.alwaysdata.net/hanesiz/dc.php', params:['email'], access:'premium'},
    {id:'turknet', name:'TÃ¼rknet', endpoint:'https://hanedansystem.alwaysdata.net/hanesiz/turknet.php', params:['tc'], access:'premium'},
    {id:'log', name:'Log Ã‡ekme', endpoint:'https://hanedansystem.alwaysdata.net/hanesiz/log.php', params:['site'], access:'premium'},
    {id:'craftrise', name:'Craftrise', endpoint:'https://hanedansystem.alwaysdata.net/hanesiz/craftrise.php', params:['ad'], access:'premium'},
    {id:'smsbomber', name:'SmsBomber', endpoint:'https://hanedansystem.alwaysdata.net/hanesiz/smsbomber.php', params:['number'], access:'premium'},
    {id:'aifoto', name:'AiFoto', endpoint:'https://hanedansystem.alwaysdata.net/hanesiz/AiFoto.php', params:['img'], access:'premium'},
  ]},
  {category:'Finans & Plaka', apis:[
    {id:'papara', name:'Papara', endpoint:'https://hanedansystem.alwaysdata.net/hanesiz/papara.php', params:['paparano'], access:'premium'},
    {id:'ininal', name:'Ä°NÄ°NAL', endpoint:'https://hanedansystem.alwaysdata.net/hanesiz/ininal.php', params:['ininalno'], access:'premium'},
    {id:'iban', name:'Ä°BAN', endpoint:'https://hanedansystem.alwaysdata.net/hanesiz/iban.php', params:['iban'], access:'premium'},
    {id:'plaka', name:'Plaka', endpoint:'https://hanedansystem.alwaysdata.net/hanesiz/plaka.php', params:['plaka'], access:'premium'},
    {id:'plakaismi', name:'Ä°sim-Plaka', endpoint:'https://hanedansystem.alwaysdata.net/hanesiz/plakaismi.php', params:['isim'], access:'premium'},
    {id:'plakaborc', name:'PlakaBorÃ§', endpoint:'https://hanedansystem.alwaysdata.net/hanesiz/plakaborc.php', params:['plaka'], access:'premium'},
    {id:'plakasg', name:'PLAKA SÄ°GORTA', endpoint:'https://hanedansystem.alwaysdata.net/hanesiz/plakasg.php', params:['plaka'], access:'premium'},
  ]},
  {category:'YabancÄ± & SaÄŸlÄ±k', apis:[
    {id:'yabanci', name:'YabancÄ±', endpoint:'https://hanedansystem.alwaysdata.net/hanesiz/yabanci.php', params:['ad','soyad'], access:'premium'},
    {id:'yabancitc', name:'TC YabancÄ±', endpoint:'https://hanedansystem.alwaysdata.net/hanesiz/yabancitc.php', params:['tc'], access:'premium'},
    {id:'sgk', name:'SGK', endpoint:'https://hanedansystem.alwaysdata.net/hanesiz/SGK.php', params:['tc'], access:'premium'},
    {id:'asi', name:'ASI', endpoint:'https://hanedansystem.alwaysdata.net/hanesiz/asi.php', params:['tc'], access:'premium'},
    {id:'ilac', name:'Ä°laÃ§', endpoint:'https://hanedansystem.alwaysdata.net/hanesiz/ilac.php', params:['ilac_adi'], access:'premium'},
  ]}
];

/* -------------------------
   Session & state
--------------------------*/
let SESSION = { user:null, role:'guest' }; // guest | free | premium | admin
let SELECTED = null;
let HISTORY = [];

/* DOM helpers */
const $ = id => document.getElementById(id);
const sideNav = $('sideNav'), sideOverlay = $('sideOverlay'), menuContainer = $('menuContainer'), sideUser = $('sideUser');
const topStatus = $('topStatus'), welcomeText = $('welcomeText'), apiTitle = $('apiTitle'), apiFlag = $('apiFlag');
const paramsArea = $('paramsArea'), resultBox = $('resultBox'), historyArea = $('historyArea');
const adminArea = $('adminArea'), adminMsg = $('adminMsg');

/* helpers */
function addDaysISO(days){ const d=new Date(); d.setDate(d.getDate()+days); return d.toISOString(); }
function isPremiumActive(userObj){ if(!userObj) return false; if(userObj.role==='admin') return true; if(userObj.premium_until) return new Date(userObj.premium_until) > new Date(); return false; }

/* side controls */
function openSide(){ sideNav.classList.add('open'); sideOverlay.style.display='block'; }
function closeSide(){ sideNav.classList.remove('open'); sideOverlay.style.display='none'; }
$('hambBtn').addEventListener('click', ()=>{ if(sideNav.classList.contains('open')) closeSide(); else openSide(); });
sideOverlay.addEventListener('click', closeSide);

/* build menu */
function buildMenu(){
  menuContainer.innerHTML = '';
  const hdr = document.createElement('div'); hdr.className='cat'; hdr.innerText='Sorgular'; menuContainer.appendChild(hdr);

  CATALOG.forEach(cat=>{
    const catEl = document.createElement('div'); catEl.className='cat'; catEl.innerText = cat.category; menuContainer.appendChild(catEl);
    cat.apis.forEach(a=>{
      const users = loadUsers(); const u = users[SESSION.user];
      const locked = a.access === 'premium' && !isPremiumActive(u);
      const item = document.createElement('div'); item.className = 'api-item' + (locked ? ' locked' : '');
      item.innerHTML = `<div style="font-weight:600">${a.name}</div><div class="lock-pill">${locked? 'ðŸ”’':'Kullan'}</div>`;
      item.addEventListener('click', ()=>{ if(locked){ openMarket(); return; } selectApi(a); closeSide(); });
      menuContainer.appendChild(item);
    });
  });

  if(SESSION.role === 'admin'){
    const hr = document.createElement('div'); hr.style.marginTop='12px';
    const adminBtn = document.createElement('button'); adminBtn.className='btn-ghost'; adminBtn.innerText='YÃ¶netici: Premium Ver'; adminBtn.addEventListener('click', ()=>{ openAdminPanel(); closeSide(); });
    hr.appendChild(adminBtn); menuContainer.appendChild(hr);
  }
}

/* select api */
function selectApi(api){
  SELECTED = api;
  apiTitle.innerText = api.name;
  apiFlag.innerText = api.access.toUpperCase();
  paramsArea.innerHTML = '';
  api.params.forEach((p,i)=>{
    const wrapper = document.createElement('div');
    const label = document.createElement('div'); label.className='muted'; label.innerText = p;
    const input = document.createElement('input'); input.type='text'; input.placeholder = p; input.id = `param_${i}`;
    wrapper.appendChild(label); wrapper.appendChild(input);
    paramsArea.appendChild(wrapper);
  });
}

/* run query */
async function runQuery(){
  if(!SELECTED){ alert('Ã–nce bir API seÃ§in'); return; }
  const users = loadUsers(); const userObj = users[SESSION.user];
  if(SELECTED.access === 'premium' && !isPremiumActive(userObj)){ openMarket(); return; }

  const vals = SELECTED.params.map((_,i)=> document.getElementById(`param_${i}`)?.value?.trim() || '');
  if(vals.some(v=>v==='')){ alert('TÃ¼m parametreleri doldurun'); return; }

  // build URL (we won't display provider name in UI)
  const qs = SELECTED.params.map((k,i)=> `${encodeURIComponent(k)}=${encodeURIComponent(vals[i])}`).join('&');
  const url = `${SELECTED.endpoint}?${qs}`;

  resultBox.innerText = `Sorgu gÃ¶nderildi. SonuÃ§ alÄ±nÄ±yor...`;
  HISTORY.unshift({time:(new Date()).toLocaleString(), api:SELECTED.name, urlMasked: SELECTED.name + ' (gizli endpoint)'});
  renderHistory();

  try{
    const res = await fetch(url, {method:'GET'});
    const text = await res.text();
    try{ const j = JSON.parse(text); resultBox.innerText = JSON.stringify(j, null, 2); }
    catch(e){ resultBox.innerText = text; }
  }catch(err){
    resultBox.innerText = `Ä°stek baÅŸarÄ±sÄ±z: ${err.message}\n\nNot: TarayÄ±cÄ± CORS kÄ±sÄ±tlarÄ± olabilir. Ãœretimde server-side proxy Ã¶nerilir.`;
  }
}

/* history */
function renderHistory(){
  if(HISTORY.length === 0){ historyArea.innerText = 'HenÃ¼z sorgu yok.'; return; }
  historyArea.innerText = HISTORY.slice(0,30).map(h => `${h.time} â€” ${h.api}\n${h.urlMasked || ''}`).join('\n\n');
}

/* market */
function openMarket(){ $('marketModal').style.display='flex'; }
function closeMarket(){ $('marketModal').style.display='none'; }
function buyPlan(plan){ alert(`${plan} paketi demo. Discord: SrapionV4 ile iletiÅŸime geÃ§in.`); closeMarket(); }

/* admin panel */
function openAdminPanel(){
  adminArea.style.display = 'block';
  adminMsg.innerText = '';
  adminArea.scrollIntoView({behavior:'smooth'});
}
$('createPremiumBtn').addEventListener('click', ()=>{
  const email = $('newUserEmail').value.trim().toLowerCase();
  const pass = $('newUserPass').value;
  const days = parseInt($('newUserDuration').value,10);
  if(!email || !pass){ alert('E-posta ve ÅŸifre girin'); return; }
  const users = loadUsers();
  const until = addDaysISO(days);
  users[email] = { pass: pass, role: 'premium', premium_until: until };
  saveUsers(users);
  adminMsg.innerText = `${email} iÃ§in premium verildi â€” ${days} gÃ¼n (expires: ${new Date(until).toLocaleString()})`;
  buildMenu();
});

/* login/logout/free */
function doFreeLogin(){
  const guest = 'guest_' + Math.floor(Math.random()*90000+10000) + '@guest.local';
  const users = loadUsers(); if(!users[guest]) users[guest] = { pass:'', role:'free', premium_until:null }; saveUsers(users);
  SESSION.user = guest; SESSION.role = 'free';
  afterLogin();
}

function doLogin(email, pass){
  if(!email || !pass){ alert('E-posta ve ÅŸifre girin'); return; }
  const users = loadUsers();
  if(!users[email]){ if(confirm('KullanÄ±cÄ± bulunamadÄ±. Yeni Ã¼cretsiz kullanÄ±cÄ± oluÅŸturulsun mu?')){ users[email] = { pass: pass, role:'free', premium_until:null }; saveUsers(users); alert('KullanÄ±cÄ± oluÅŸturuldu. Tekrar giriÅŸ yapÄ±n.'); } return; }
  const u = users[email];
  if(u.premium_until && new Date(u.premium_until) <= new Date()){ alert('Bu hesabÄ±n sÃ¼resi dolmuÅŸ. GiriÅŸ yapÄ±lamaz.'); return; }
  if(u.pass === pass){ SESSION.user = email; SESSION.role = u.role === 'admin' ? 'admin' : (isPremiumActive(u) ? 'premium' : 'free'); afterLogin(); return; }
  alert('Åžifre hatalÄ±');
}

/* admin login with explicit admin credentials */
function doAdminLogin(email, pass){
  // The seeded admin has the requested credentials:
  // admin@gmail.com / Malta233214
  if(email === 'admin@gmail.com' && pass === 'Malta233214'){
    const users = loadUsers(); users[email] = users[email] || { pass:'Malta233214', role:'admin', premium_until:null }; saveUsers(users);
    SESSION.user = email; SESSION.role = 'admin'; afterLogin(); return;
  }
  // else fallback to normal login (in case admin changed)
  doLogin(email, pass);
}

function afterLogin(){
  document.body.classList.remove('login-mode'); document.body.classList.add('app-mode');
  $('loginModal').style.display = 'none';
  sideUser.innerText = SESSION.user;
  topStatus.innerText = `Durum: ${SESSION.role.toUpperCase()}`;
  welcomeText.innerText = `${SESSION.user} (${SESSION.role})`;
  SELECTED = null; apiTitle.innerText = 'HenÃ¼z seÃ§ilmedi'; apiFlag.innerText = 'â€”'; paramsArea.innerHTML=''; resultBox.innerText = 'Sorgu sonuÃ§larÄ± burada gÃ¶rÃ¼necek.';
  renderHistory(); buildMenu();
  adminArea.style.display = SESSION.role === 'admin' ? 'block' : 'none';
  closeSide();
}

function logout(){
  if(!confirm('Ã‡Ä±kÄ±ÅŸ yapmak istiyor musunuz?')) return;
  SESSION = { user:null, role:'guest' };
  sideUser.innerText = 'HenÃ¼z giriÅŸ yok';
  topStatus.innerText = 'Durum: GiriÅŸ yapÄ±lmadÄ±';
  welcomeText.innerText = 'LÃ¼tfen giriÅŸ yapÄ±n';
  apiTitle.innerText = 'HenÃ¼z seÃ§ilmedi';
  apiFlag.innerText = 'â€”';
  paramsArea.innerHTML = '';
  resultBox.innerText = 'Sorgu sonuÃ§larÄ± burada gÃ¶rÃ¼necek.';
  buildMenu();
  $('loginModal').style.display = 'flex';
  document.body.classList.remove('app-mode'); document.body.classList.add('login-mode');
  adminArea.style.display = 'none';
}

/* auth form bindings */
$('doFreeLoginBtn').addEventListener('click', doFreeLogin);
$('showAdminBtn').addEventListener('click', ()=>{ $('adminForm').style.display='block'; $('premiumForm').style.display='none'; });
$('showPremiumBtn').addEventListener('click', ()=>{ $('premiumForm').style.display='block'; $('adminForm').style.display='none'; });
$('adminCancelBtn').addEventListener('click', ()=>{ $('adminForm').style.display='none'; });
$('premCancelBtn').addEventListener('click', ()=>{ $('premiumForm').style.display='none'; });

$('adminSubmitBtn').addEventListener('click', ()=>{
  const email = $('adminEmail').value.trim().toLowerCase(); const pass = $('adminPass').value;
  doAdminLogin(email, pass);
});
$('premSubmitBtn').addEventListener('click', ()=>{
  const email = $('premEmail').value.trim().toLowerCase(); const pass = $('premPass').value;
  doLogin(email, pass);
});

/* other binds */
$('openMarketBtn').addEventListener('click', openMarket);
$('closeMarketBtn').addEventListener('click', closeMarket);
$('runQueryBtn').addEventListener('click', runQuery);
$('clearBtn').addEventListener('click', ()=>{ paramsArea.innerHTML=''; resultBox.innerText='Sorgu sonuÃ§larÄ± burada gÃ¶rÃ¼necek.'; SELECTED=null; apiTitle.innerText='HenÃ¼z seÃ§ilmedi'; apiFlag.innerText='â€”'; });
$('logoutBtn').addEventListener('click', logout);

/* initialization */
document.addEventListener('DOMContentLoaded', ()=>{
  document.body.classList.add('login-mode');
  $('loginModal').style.display='flex';
  buildMenu();
  renderHistory();
});

/* expose debug */
window._malta = { SESSION, CATALOG, loadUsers, saveUsers, runQuery, selectApi, buildMenu };

/* helpers duplicate (kept at end) */
function loadUsers(){ try{ return JSON.parse(localStorage.getItem(USERS_KEY)) || {}; }catch(e){ return {}; } }
function saveUsers(u){ localStorage.setItem(USERS_KEY, JSON.stringify(u)); }
</script>
</body>
</html>
