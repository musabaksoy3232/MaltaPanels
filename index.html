<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Malta Sorgu Paneli â€” Premium YÃ¶netimi</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --card: rgba(6,10,18,0.86);
  --muted: #9fb0c2;
  --accentA: #06b6d4;
  --accentB: #6ee7b7;
  --glass: rgba(255,255,255,0.04);
}
*{box-sizing:border-box;font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Arial;}
html,body{height:100%;margin:0;background:#000;color:#eaf6fb}
.bg{
  position:fixed;inset:0;
  background-image:
    linear-gradient(180deg, rgba(2,6,12,0.6), rgba(2,6,12,0.6)),
    url('https://tor-lodz.pl/supercars/porsche-911-turbo-s?srsltid=AfmBOoo6q-63UfNTBJ2C-ksH8wOb5M2Q4KGCI1RDHe-FS6gOJR5z0epL');
  background-size:cover;background-position:center center;z-index:0;filter:brightness(.92);
}
/* App */
.app{position:relative;z-index:5;max-width:1200px;margin:28px auto;padding:0 18px}
.topbar{display:flex;align-items:center;gap:14px;margin-bottom:14px}
.hamb{width:56px;height:56px;border-radius:12px;background:var(--card);display:flex;align-items:center;justify-content:center;cursor:pointer;border:1px solid var(--glass);box-shadow:0 8px 24px rgba(2,6,12,0.6)}
.brand h1{margin:0;font-size:18px}
.brand p{margin:0;color:var(--muted);font-size:13px}
/* layout */
.main-row{display:flex;gap:16px;align-items:flex-start}
/* side nav */
.side-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.45);z-index:40;opacity:0;visibility:hidden;transition:opacity .25s ease}
.side-overlay.show{opacity:1;visibility:visible}
.side-nav{
  position:fixed;left:-360px;top:0;bottom:0;width:320px;background:linear-gradient(180deg,rgba(6,8,12,0.96),rgba(4,6,12,0.96));
  box-shadow:0 18px 50px rgba(2,6,12,0.6);padding:18px;z-index:50;transition:left .28s ease;overflow-y:auto;
}
.side-nav.open{left:0}
.side-nav .logo{font-weight:700;margin-bottom:6px}
.side-nav .user{padding:10px;background:rgba(255,255,255,0.02);border-radius:10px;margin-bottom:8px}
.side-nav .cat{font-size:13px;color:var(--muted);margin-top:12px;margin-bottom:8px}
.side-nav .api-item{display:flex;justify-content:space-between;align-items:center;padding:8px;border-radius:8px;cursor:pointer}
.side-nav .api-item:hover{background:rgba(255,255,255,0.02)}
.side-nav .locked{opacity:.55;font-size:12px;color:var(--muted)}
/* main */
.card{background:var(--card);border-radius:12px;padding:18px;border:1px solid rgba(255,255,255,0.02);box-shadow:0 14px 40px rgba(2,6,12,.6)}
.panel{flex:1;min-height:72vh;display:flex;flex-direction:column;gap:12px}
.panel-head{display:flex;justify-content:space-between;align-items:center}
.params{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:10px;margin-top:12px}
input,select,textarea{background:transparent;border:1px solid rgba(255,255,255,0.04);color:inherit;padding:10px;border-radius:8px;width:100%}
.btn-primary{background:linear-gradient(90deg,var(--accentB),var(--accentA));border:none;color:#022;padding:10px 14px;border-radius:10px;cursor:pointer}
.btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px;border-radius:8px;color:var(--muted);cursor:pointer}
.right-col{width:420px;min-height:72vh;display:flex;flex-direction:column;gap:12px}
.result-title{color:var(--muted);font-size:13px}
.result-box{background:rgba(2,6,12,0.7);padding:12px;border-radius:10px;min-height:320px;white-space:pre-wrap;overflow:auto;border:1px solid rgba(255,255,255,0.02)}
.history{background:transparent;color:var(--muted);min-height:80px;border:none;white-space:pre-wrap}
.admin-area{margin-top:12px;background:rgba(255,255,255,0.02);padding:12px;border-radius:10px}
.muted{color:var(--muted);font-size:13px}
.pill{background:rgba(255,255,255,0.03);padding:6px 10px;border-radius:999px;font-size:13px}
@media(max-width:980px){ .right-col{display:none} .side-nav{width:280px} }
@media(max-width:640px){ .hamb{width:48px;height:48px} }
/* login modal */
#loginModal{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;z-index:55}
.login-card{width:880px;max-width:96%;display:grid;grid-template-columns:1fr 420px;border-radius:14px;overflow:hidden;box-shadow:0 30px 80px rgba(1,6,15,0.7)}
.login-left{background:linear-gradient(180deg, rgba(6,10,18,0.9), rgba(4,8,14,0.88));padding:30px;display:flex;flex-direction:column;gap:14px}
.login-right{background:center/cover;padding:30px;display:flex;align-items:center;justify-content:center;}
.glass{background:rgba(255,255,255,0.02);padding:12px;border-radius:10px}
.small{font-size:12px;color:var(--muted)}
.warn{color:#ffd28a}
.err{color:#ff9b9b}
.success{color:#9ef0b2}
</style>
</head>
<body>
  <div class="bg"></div>

  <div class="app">
    <header class="topbar">
      <div class="hamb" id="hambBtn" title="MenÃ¼yÃ¼ aÃ§/kapat">â˜°</div>
      <div class="brand">
        <h1>Malta Sorgu Paneli</h1>
        <p class="muted">Admin: premium ver â€¢ Ãœcretsiz giriÅŸ: ÃœNÄ°'ye kadar</p>
      </div>
      <div style="flex:1"></div>
      <div class="muted" id="topStatus">Durum: GiriÅŸ yapÄ±lmadÄ±</div>
    </header>

    <div class="main-row">
      <div class="side-nav card" id="sideNav" aria-hidden="true">
        <div class="logo">MenÃ¼</div>
        <div class="user pill" id="sideUser">HenÃ¼z giriÅŸ yok</div>
        <div id="menuContainer"></div>
        <div style="margin-top:auto;display:flex;gap:8px">
          <button class="btn-ghost" id="openMarketBtn">Market</button>
          <button class="btn-ghost" id="logoutBtn">Ã‡Ä±kÄ±ÅŸ</button>
        </div>
      </div>

      <div class="side-overlay" id="sideOverlay"></div>

      <main class="panel card" id="mainPanel">
        <div class="panel-head">
          <h2 id="panelTitle">Sorgu Paneli</h2>
          <div class="muted" id="welcomeText">LÃ¼tfen giriÅŸ yapÄ±n</div>
        </div>

        <div style="display:flex;gap:18px;align-items:flex-start">
          <div style="flex:1">
            <div class="card">
              <div class="muted">SeÃ§ili API</div>
              <div style="font-weight:700;margin-top:6px" id="apiTitle">HenÃ¼z seÃ§ilmedi</div>
              <div class="muted" style="margin-top:4px">EriÅŸim: <span id="apiFlag">â€”</span></div>

              <div style="margin-top:12px" class="muted">Parametreler</div>
              <div class="params" id="paramsArea"></div>

              <div style="margin-top:12px;display:flex;gap:8px">
                <button class="btn-primary" id="runQueryBtn">Sorgula</button>
                <button class="btn-ghost" id="clearBtn">Temizle</button>
              </div>
            </div>

            <div class="card" style="margin-top:12px">
              <div class="muted">GeÃ§miÅŸ (Bu oturum)</div>
              <pre class="history" id="historyArea">HenÃ¼z sorgu yok.</pre>
            </div>

            <div id="adminArea" class="admin-area" style="display:none">
              <h4>Admin - Premium Ver</h4>
              <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:8px">
                <input id="newUserEmail" placeholder="KullanÄ±cÄ± e-posta (Ã¶rnek: user@gmail.com)" style="min-width:220px">
                <input id="newUserPass" placeholder="Åžifre">
                <select id="newUserDuration">
                  <option value="1">1 GÃ¼n</option>
                  <option value="7">7 GÃ¼n</option>
                  <option value="30">30 GÃ¼n</option>
                  <option value="365">365 GÃ¼n</option>
                </select>
                <button class="btn-primary" id="createPremiumBtn">Premium Ver / KullanÄ±cÄ± OluÅŸtur</button>
              </div>
              <div class="small">Form: e-posta + ÅŸifre + sÃ¼re. SÃ¼re dolunca o kullanÄ±cÄ± giriÅŸ yapamayacak.</div>
              <div id="adminMsg" class="muted" style="margin-top:8px"></div>
            </div>

          </div>

          <aside class="right-col">
            <div class="card">
              <div class="result-title">SonuÃ§</div>
              <div class="result-box" id="resultBox">Sorgu sonuÃ§larÄ± burada gÃ¶rÃ¼necek.</div>
              <div style="margin-top:12px" class="muted">Not: EÄŸer CORS hatasÄ± gÃ¶rÃ¼yorsanÄ±z sunucu proxy gerekir.</div>
            </div>
          </aside>
        </div>
      </main>
    </div>
  </div>

  <!-- Market modal -->
  <div id="marketModal" style="position:fixed;inset:0;display:none;align-items:center;justify-content:center;z-index:60">
    <div style="width:720px;max-width:96%;background:linear-gradient(180deg,rgba(6,10,18,0.96),rgba(3,6,10,0.96));padding:22px;border-radius:12px;box-shadow:0 30px 80px rgba(0,0,0,0.6);">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <h3 style="margin:0;color:var(--accentB)">Market â€” Premium Paketler</h3>
        <button class="btn-ghost" id="closeMarketBtn">Kapat</button>
      </div>
      <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:12px;margin-top:16px">
        <div style="background:rgba(255,255,255,0.02);padding:14px;border-radius:10px">
          <div style="font-weight:700">GÃ¼nlÃ¼k</div><div class="muted">1 GÃ¼n</div><div style="margin-top:8px;font-size:18px;font-weight:700">200â‚º</div>
          <button class="btn-primary" style="margin-top:10px" onclick="buyPlan('GÃ¼nlÃ¼k')">SatÄ±n Al</button>
        </div>
        <div style="background:rgba(255,255,255,0.02);padding:14px;border-radius:10px">
          <div style="font-weight:700">HaftalÄ±k</div><div class="muted">7 GÃ¼n</div><div style="margin-top:8px;font-size:18px;font-weight:700">700â‚º</div>
          <button class="btn-primary" style="margin-top:10px" onclick="buyPlan('HaftalÄ±k')">SatÄ±n Al</button>
        </div>
        <div style="background:rgba(255,255,255,0.02);padding:14px;border-radius:10px">
          <div style="font-weight:700">AylÄ±k</div><div class="muted">30 GÃ¼n</div><div style="margin-top:8px;font-size:18px;font-weight:700">1000â‚º</div>
          <button class="btn-primary" style="margin-top:10px" onclick="buyPlan('AylÄ±k')">SatÄ±n Al</button>
        </div>
        <div style="background:rgba(255,255,255,0.02);padding:14px;border-radius:10px">
          <div style="font-weight:700">YÄ±llÄ±k</div><div class="muted">365 GÃ¼n</div><div style="margin-top:8px;font-size:18px;font-weight:700">4000â‚º</div>
          <button class="btn-primary" style="margin-top:10px" onclick="buyPlan('YÄ±llÄ±k')">SatÄ±n Al</button>
        </div>
      </div>
      <div style="margin-top:14px" class="muted">SatÄ±n alma demo: Discord: <strong>SrapionV4</strong></div>
    </div>
  </div>

  <!-- login modal -->
  <div id="loginModal" style="position:fixed;inset:0;display:flex;align-items:center;justify-content:center;z-index:55">
    <div class="login-card">
      <div class="login-left">
        <h1 style="color:var(--accentB);margin:0">Malta Sorgu Paneli</h1>
        <p class="muted">Ãœcretsiz giriÅŸ ile ÃœNÄ°'ye kadar. Admin: admin@gmail.com / 233214</p>
        <div style="display:flex;gap:12px">
          <button class="btn-primary" id="showLoginFormBtn">Gmail ile GiriÅŸ</button>
          <button class="btn-ghost" id="doFreeLoginBtn">Ãœcretsiz GiriÅŸ</button>
        </div>
        <div class="muted">Admin bilgisi client-side seed olarak mevcut (daha sonra server-side yapÄ±lmalÄ±).</div>
      </div>
      <div class="login-right" style="background-image:url('https://tor-lodz.pl/supercars/porsche-911-turbo-s?srsltid=AfmBOoo6q-63UfNTBJ2C-ksH8wOb5M2Q4KGCI1RDHe-FS6gOJR5z0epL')">
        <div class="glass" style="width:100%">
          <div class="muted" style="margin-bottom:8px">E-posta (Gmail)</div>
          <input id="loginEmail" type="email" placeholder="you@gmail.com" style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04)">
          <div class="muted" style="margin-top:8px">Åžifre</div>
          <input id="loginPass" type="password" placeholder="ÅŸifre" style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04)">
          <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
            <button class="btn-ghost" id="cancelLoginBtn">Ä°ptal</button>
            <button class="btn-primary" id="submitLoginBtn">GiriÅŸ Yap</button>
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
/* client-side kullanÄ±cÄ± deposu */
const USERS_KEY = 'malta_users_clean_v1';
function loadUsers(){ try{ return JSON.parse(localStorage.getItem(USERS_KEY)) || {}; }catch(e){ return {}; } }
function saveUsers(u){ localStorage.setItem(USERS_KEY, JSON.stringify(u)); }
/* seed admin */
(function(){ const u = loadUsers(); if(!u['admin@gmail.com']){ u['admin@gmail.com'] = { pass:'233214', role:'admin', premium_until:null }; saveUsers(u); } })();

/* API katalogu (isimler genel; endpointler proxy iÃ§in /api/... olarak bÄ±rakÄ±ldÄ±) */
const API_BASE = ''; // set to '' so endpoints are relative (e.g. /api/xxx). Adjust in backend if needed.
const CATALOG = [
  {category:'Ad & KiÅŸi', apis:[
    {id:'adsoyad', name:'Ad Soyad', endpoint:'/api/adsoyad.php', params:['ad','soyad'], access:'free'},
    {id:'adsoyadpro', name:'Ad Soyad Pro', endpoint:'/api/adsoyadpro.php', params:['ad','soyad','il','ilce'], access:'free'},
    {id:'adililce', name:'Ad Ä°l Ä°lÃ§e', endpoint:'/api/adililce.php', params:['ad','il','ilce'], access:'free'},
    {id:'adil', name:'Ad Ä°l', endpoint:'/api/adil.php', params:['ad','ilce'], access:'free'},
  ]},
  {category:'TC & GSM', apis:[
    {id:'tcpro', name:'TCPRO', endpoint:'/api/tcpro.php', params:['tc'], access:'free'},
    {id:'tc', name:'TC Sorgu', endpoint:'/api/tc.php', params:['tc'], access:'free'},
    {id:'serino', name:'SeriNo Sorgu', endpoint:'/api/serino.php', params:['tc'], access:'free'},
    {id:'tcgsm', name:'TC GSM Sorgu', endpoint:'/api/tcgsm.php', params:['tc'], access:'free'},
    {id:'gsmtc', name:'GSM TC Sorgu', endpoint:'/api/gsmtc.php', params:['gsm'], access:'free'},
    {id:'adres', name:'Adres Sorgu', endpoint:'/api/adres.php', params:['tc'], access:'free'},
    {id:'hane', name:'Hane Sorgu', endpoint:'/api/hane.php', params:['tc'], access:'free'},
    {id:'aile', name:'Aile Sorgu', endpoint:'/api/aile.php', params:['tc'], access:'free'},
    {id:'sulale', name:'SÃ¼lale Sorgu', endpoint:'/api/sulale.php', params:['tc'], access:'free'},
    {id:'sicil', name:'Sicil', endpoint:'/api/sicil.php', params:['eski_dosya_id'], access:'premium'},
  ]},
  {category:'EÄŸitim', apis:[
    {id:'ogretmen', name:'Ã–ÄŸretmen', endpoint:'/api/ogretmen.php', params:['ad','soyad'], access:'free'},
    {id:'lgs', name:'LGS', endpoint:'/api/lgs.php', params:['tc'], access:'free'},
    {id:'uni', name:'ÃœNÄ°', endpoint:'/api/uni.php', params:['tc'], access:'free'},
    {id:'sertifika', name:'Sertifika', endpoint:'/api/sertifika.php', params:['tc'], access:'premium'},
  ]},
  {category:'DiÄŸer & Sosyal', apis:[
    {id:'vesika', name:'Vesika', endpoint:'/api/vesika.php', params:['tc'], access:'premium'},
    {id:'insta', name:'Instagram', endpoint:'/api/insta.php', params:['usr'], access:'premium'},
    {id:'discord', name:'Discord', endpoint:'/api/dc.php', params:['email'], access:'premium'},
    {id:'turknet', name:'TÃ¼rknet', endpoint:'/api/turknet.php', params:['tc'], access:'premium'},
    {id:'log', name:'Log Ã‡ekme', endpoint:'/api/log.php', params:['site'], access:'premium'},
    {id:'craftrise', name:'Craftrise', endpoint:'/api/craftrise.php', params:['ad'], access:'premium'},
    {id:'smsbomber', name:'SmsBomber', endpoint:'/api/smsbomber.php', params:['number'], access:'premium'},
    {id:'aifoto', name:'AiFoto', endpoint:'/api/AiFoto.php', params:['img'], access:'premium'},
  ]},
  {category:'Finans & Plaka', apis:[
    {id:'papara', name:'Papara', endpoint:'/api/papara.php', params:['paparano'], access:'premium'},
    {id:'ininal', name:'Ä°NÄ°NAL', endpoint:'/api/ininal.php', params:['ininalno'], access:'premium'},
    {id:'iban', name:'Ä°BAN', endpoint:'/api/iban.php', params:['iban'], access:'premium'},
    {id:'plaka', name:'Plaka', endpoint:'/api/plaka.php', params:['plaka'], access:'premium'},
    {id:'plakaismi', name:'Ä°sim-Plaka', endpoint:'/api/plakaismi.php', params:['isim'], access:'premium'},
    {id:'plakaborc', name:'PlakaBorÃ§', endpoint:'/api/plakaborc.php', params:['plaka'], access:'premium'},
    {id:'plakasg', name:'PLAKA SÄ°GORTA', endpoint:'/api/plakasg.php', params:['plaka'], access:'premium'},
  ]},
  {category:'YabancÄ± & SaÄŸlÄ±k', apis:[
    {id:'yabanci', name:'YabancÄ±', endpoint:'/api/yabanci.php', params:['ad','soyad'], access:'premium'},
    {id:'yabancitc', name:'TC YabancÄ±', endpoint:'/api/yabancitc.php', params:['tc'], access:'premium'},
    {id:'sgk', name:'SGK', endpoint:'/api/SGK.php', params:['tc'], access:'premium'},
    {id:'asi', name:'ASI', endpoint:'/api/asi.php', params:['tc'], access:'premium'},
    {id:'ilac', name:'Ä°laÃ§', endpoint:'/api/ilac.php', params:['ilac_adi'], access:'premium'},
  ]}
];

/* state */
let SESSION = { user:null, role:'guest' }; // guest | free | premium | admin
let SELECTED = null;
let HISTORY = [];

/* DOM shortcuts */
const $ = id => document.getElementById(id);
const sideNav = $('sideNav'), sideOverlay = $('sideOverlay'), menuContainer = $('menuContainer'), sideUser = $('sideUser');
const topStatus = $('topStatus'), welcomeText = $('welcomeText'), apiTitle = $('apiTitle'), apiFlag = $('apiFlag');
const paramsArea = $('paramsArea'), resultBox = $('resultBox'), historyArea = $('historyArea');
const adminArea = $('adminArea'), adminMsg = $('adminMsg');

/* helpers */
function addDaysISO(days){ const d=new Date(); d.setDate(d.getDate()+days); return d.toISOString(); }
function isPremiumActive(userObj){ if(!userObj) return false; if(userObj.role==='admin') return true; if(userObj.premium_until) return new Date(userObj.premium_until) > new Date(); return false; }

/* side controls */
function openSide(){ sideNav.classList.add('open'); sideOverlay.classList.add('show'); sideOverlay.style.display='block'; }
function closeSide(){ sideNav.classList.remove('open'); sideOverlay.classList.remove('show'); sideOverlay.style.display='none'; }
$('hambBtn').addEventListener('click', ()=>{ if(sideNav.classList.contains('open')) closeSide(); else openSide(); });
sideOverlay.addEventListener('click', closeSide);

/* build menu */
function buildMenu(){
  menuContainer.innerHTML = '';
  if(!SESSION.user){
    const note = document.createElement('div'); note.className='muted'; note.innerText='GiriÅŸ yapÄ±n â€” MenÃ¼ iÃ§in â˜°'; menuContainer.appendChild(note); return;
  }
  CATALOG.forEach(cat=>{
    const catEl = document.createElement('div'); catEl.className='cat'; catEl.innerText = cat.category; menuContainer.appendChild(catEl);
    cat.apis.forEach(a=>{
      const users = loadUsers(); const u = users[SESSION.user];
      const locked = a.access === 'premium' && !isPremiumActive(u);
      const item = document.createElement('div'); item.className = 'api-item' + (locked ? ' locked' : '');
      item.innerHTML = `<div style="font-weight:600">${a.name}</div><div class="muted">${locked? 'ðŸ”’':'Kullan'}</div>`;
      item.addEventListener('click', ()=>{ if(locked){ openMarket(); return; } selectApi(a); closeSide(); });
      menuContainer.appendChild(item);
    });
  });
  if(SESSION.role === 'admin'){
    const hr = document.createElement('div'); hr.style.marginTop='12px';
    const adminBtn = document.createElement('button'); adminBtn.className='btn-ghost'; adminBtn.innerText='YÃ¶netici: Premium Ver'; adminBtn.addEventListener('click', ()=>{ openAdminPanel(); closeSide(); });
    hr.appendChild(adminBtn); menuContainer.appendChild(hr);
  }
}

/* select API */
function selectApi(api){
  SELECTED = api;
  apiTitle.innerText = api.name;
  apiFlag.innerText = api.access.toUpperCase();
  paramsArea.innerHTML = '';
  api.params.forEach((p,i)=>{
    const input = document.createElement('input'); input.type='text'; input.placeholder = p; input.id = `param_${i}`; paramsArea.appendChild(input);
  });
}

/* run query */
async function runQuery(){
  if(!SELECTED){ alert('Ã–nce bir API seÃ§in'); return; }
  const users = loadUsers(); const u = users[SESSION.user];
  if(SELECTED.access === 'premium' && !isPremiumActive(u)){ openMarket(); return; }
  const vals = SELECTED.params.map((_,i)=> document.getElementById(`param_${i}`)?.value?.trim() || '');
  if(vals.some(v=>v==='')){ alert('TÃ¼m parametreleri doldurun'); return; }
  const qs = SELECTED.params.map((k,i)=> `${encodeURIComponent(k)}=${encodeURIComponent(vals[i])}`).join('&');
  const url = API_BASE + SELECTED.endpoint + (qs ? ('?' + qs) : '');
  resultBox.innerText = `Sorgu gÃ¶nderiliyor: ${url}\n\nLÃ¼tfen bekleyin...`;
  HISTORY.unshift({time:(new Date()).toLocaleString(), api:SELECTED.name, url});
  renderHistory();
  try{
    const res = await fetch(url, {method:'GET'});
    const text = await res.text();
    try{ const j = JSON.parse(text); resultBox.innerText = JSON.stringify(j,null,2); }
    catch(e){ resultBox.innerText = text; }
  }catch(err){
    resultBox.innerText = `Ä°stek baÅŸarÄ±sÄ±z: ${err.message}\n\nNot: CORS hatasÄ± alÄ±rsanÄ±z sunucu proxy gerekir.`;
  }
}

/* render history */
function renderHistory(){ if(HISTORY.length===0){ historyArea.innerText='HenÃ¼z sorgu yok.'; return; } historyArea.innerText = HISTORY.slice(0,30).map(h=>`${h.time} â€” ${h.api}\n${h.url}`).join('\n\n'); }

/* market */
function openMarket(){ $('marketModal').style.display='flex'; }
function closeMarket(){ $('marketModal').style.display='none'; }
function buyPlan(plan){ alert(`${plan} paketi demo: Discord SrapionV4 ile iletiÅŸime geÃ§in.`); closeMarket(); }

/* Admin: panel + create premium */
function openAdminPanel(){
  // show admin area in page
  adminArea.style.display = 'block';
  adminMsg.innerText = '';
  adminArea.scrollIntoView({behavior:'smooth'});
}
$('createPremiumBtn').addEventListener('click', ()=>{
  const email = $('newUserEmail').value.trim().toLowerCase();
  const pass = $('newUserPass').value;
  const days = parseInt($('newUserDuration').value,10);
  if(!email || !pass){ alert('E-posta ve ÅŸifre girin'); return; }
  const users = loadUsers();
  const until = addDaysISO(days);
  users[email] = { pass: pass, role: 'premium', premium_until: until };
  saveUsers(users);
  adminMsg.innerText = `${email} iÃ§in premium verildi â€” ${days} gÃ¼n (expires: ${new Date(until).toLocaleString()})`;
  buildMenu();
});

/* login / logout / free */
function doFreeLogin(){
  const guest = 'guest_' + Math.floor(Math.random()*90000+10000) + '@guest.local';
  const users = loadUsers(); if(!users[guest]) users[guest] = { pass:'', role:'free', premium_until:null };
  saveUsers(users);
  SESSION.user = guest; SESSION.role = 'free'; afterLogin();
}
function doGmailLogin(){
  const email = $('loginEmail').value.trim().toLowerCase(); const pass = $('loginPass').value;
  if(!email || !pass){ alert('E-posta ve ÅŸifre girin'); return; }
  const users = loadUsers();
  // check existence
  if(users[email]){
    // if user has premium_until and it's expired -> block login (per requirement)
    const u = users[email];
    if(u.premium_until && new Date(u.premium_until) <= new Date()){
      alert('Bu hesabÄ±n sÃ¼resi dolmuÅŸ. GiriÅŸ yapÄ±lamaz.');
      return;
    }
    if(u.pass === pass){
      SESSION.user = email;
      SESSION.role = u.role === 'admin' ? 'admin' : (isPremiumActive(u) ? 'premium' : 'free');
      afterLogin(); return;
    } else { alert('Åžifre hatalÄ±'); return; }
  }
  // fallback admin seed check
  if(email === 'admin@gmail.com' && pass === '233214'){ SESSION.user = email; SESSION.role = 'admin'; afterLogin(); return; }
  // new user creation prompt
  if(confirm('KullanÄ±cÄ± bulunamadÄ±. Yeni Ã¼cretsiz kullanÄ±cÄ± oluÅŸturulsun mu?')){
    users[email] = { pass: pass, role:'free', premium_until:null };
    saveUsers(users);
    alert('KullanÄ±cÄ± oluÅŸturuldu. Tekrar giriÅŸ yapÄ±n.');
  }
}
function afterLogin(){
  sideUser.innerText = SESSION.user;
  topStatus.innerText = `Durum: ${SESSION.role.toUpperCase()}`;
  welcomeText.innerText = `${SESSION.user} (${SESSION.role})`;
  SELECTED = null; apiTitle.innerText='HenÃ¼z seÃ§ilmedi'; apiFlag.innerText='â€”'; paramsArea.innerHTML=''; resultBox.innerText='Sorgu sonuÃ§larÄ± burada gÃ¶rÃ¼necek.';
  renderHistory(); buildMenu();
  $('loginModal').style.display='none'; closeSide();
  adminArea.style.display = SESSION.role === 'admin' ? 'block' : 'none';
}
function logout(){ if(!confirm('Ã‡Ä±kÄ±ÅŸ yapmak istiyor musunuz?')) return; SESSION = { user:null, role:'guest'}; sideUser.innerText='HenÃ¼z giriÅŸ yok'; topStatus.innerText='Durum: GiriÅŸ yapÄ±lmadÄ±'; welcomeText.innerText='LÃ¼tfen giriÅŸ yapÄ±n'; apiTitle.innerText='HenÃ¼z seÃ§ilmedi'; apiFlag.innerText='â€”'; paramsArea.innerHTML=''; resultBox.innerText='Sorgu sonuÃ§larÄ± burada gÃ¶rÃ¼necek.'; buildMenu(); $('loginModal').style.display='flex'; adminArea.style.display='none'; }

/* binds */
$('showLoginFormBtn').addEventListener('click', ()=>{$('loginModal').style.display='flex';});
$('doFreeLoginBtn').addEventListener('click', doFreeLogin);
$('cancelLoginBtn').addEventListener('click', ()=>{$('loginModal').style.display='flex';});
$('submitLoginBtn').addEventListener('click', doGmailLogin);
$('openMarketBtn').addEventListener('click', openMarket);
$('closeMarketBtn').addEventListener('click', closeMarket);
$('runQueryBtn').addEventListener('click', runQuery);
$('clearBtn').addEventListener('click', ()=>{ paramsArea.innerHTML=''; resultBox.innerText='Sorgu sonuÃ§larÄ± burada gÃ¶rÃ¼necek.'; SELECTED=null; apiTitle.innerText='HenÃ¼z seÃ§ilmedi'; apiFlag.innerText='â€”'; });
$('logoutBtn').addEventListener('click', logout);

/* init */
document.addEventListener('DOMContentLoaded', ()=>{ $('loginModal').style.display='flex'; buildMenu(); renderHistory(); adminArea.style.display='none'; });

/* expose for debugging */
window._malta = { SESSION, CATALOG, loadUsers, saveUsers, runQuery, selectApi, buildMenu };

/* helpers: load/save (kept here to avoid duplicate definitions) */
function loadUsers(){ try{ return JSON.parse(localStorage.getItem(USERS_KEY)) || {}; }catch(e){ return {}; } }
function saveUsers(u){ localStorage.setItem(USERS_KEY, JSON.stringify(u)); }
</script>
</body>
</html>
****# MaltaPanels
